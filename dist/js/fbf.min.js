"use strict";var Fbf=function(){function s(){}return s.setDataTypeValues=function(e,t){return s.nSMID=e,s.nRelationType=t,$("#smID,#fake_smID").val(s.nSMID.toString()),$("#relationType,#fake_relationType").val(s.nRelationType.toString()),0},s.prototype.changeRelationType=function(e){s.setDataTypeValues(s.nSMID,e),this.getFriends(!1)},s.defineDataType=function(e){return/id="friends_user_row\d+"/i.test(e)?s.setDataTypeValues(2,0):/i\.mycdn\.me/i.test(e)?/friendSubscribers/i.test(e)?s.setDataTypeValues(3,2):s.setDataTypeValues(3,1):/friend_list_item/i.test(e)?s.setDataTypeValues(1,1):/fbProfileBrowserListItem/i.test(e)?s.setDataTypeValues(1,2):s.setDataTypeValues(0,0)},s.prototype.getFriends=function(e){void 0===e&&(e=!0);var t=$("#ta").val();e&&s.defineDataType(t),fbf.fillFriendTable(t)},s.prototype.fillFriendTable=function(e){var n=[],t=$(e);if(s.arFriends=[],0!==s.nRelationType){if(1===s.nRelationType)switch(s.nSMID){case 1:$('li>[data-testid="friend_list_item"]',t).each(function(){var e=this,t=$("a[data-hovercard]",e).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(t&&t[1]){var a=t[1],i=$('img[role="img"]',e).attr("aria-label"),r=$('img[role="img"]',e).attr("src");n.push({fbID:a,title:i,face:_.unescape(r)})}});break;case 2:$(".friends_user_row",t).each(function(){var e=this,t=$(e).attr("id").match(/friends_user_row(\d+)/);if(t&&t[1]){var a=t[1],i=$(".friends_field_title a",e).html().replace(/<br>/gi," "),r=$("img.friends_photo_img",e).attr("src");n.push({fbID:a,title:i,face:_.unescape(r)})}});break;case 3:$(".ugrid_i",t).each(function(){var e=this,t=$(".entity-item",e).data("entity-id"),a=$(".ucard-w_t a",e).html().replace(/<br>/gi," "),i="https:"+$("img.photo_img",e).attr("src");n.push({fbID:t,title:a,face:_.unescape(i)})})}else switch(s.nSMID){case 1:$("li.fbProfileBrowserListItem",t).each(function(){var e=this,t=$("a[data-hovercard]",e).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(t&&t[1]){var a=t[1],i=$('img[role="img"]',e).attr("aria-label"),r=$('img[role="img"]',e).attr("src");n.push({fbID:a,title:i,face:_.unescape(r)})}});break;case 2:$(".friends_user_row",t).each(function(){var e=this,t=$(e).attr("id").match(/friends_user_row(\d+)/);if(t&&t[1]){var a=t[1],i=$(".friends_field_title a",e).html().replace(/<br>/gi," "),r=$("img.friends_photo_img",e).attr("src");n.push({fbID:a,title:i,face:_.unescape(r)})}});break;case 3:$(".ugrid_i",t).each(function(){var e=this,t=$(".__l",e).data("id"),a=$(".caption .ellip a",e).html().replace(/<br>/gi," "),i="https:"+$("img.photo_img",e).attr("src");n.push({fbID:t,title:a,face:_.unescape(i)})})}s.arFriends=n.map(function(e){return e.smID=s.nSMID,e.relationType=s.nRelationType,e})}s.drawUsers(),$("input[name=withfaces]","#fmGetFriends").prop("checked",s.arFriends.length<=s.WITH_FACES_MAX_COUNT)},s.drawUsers=function(){var a=$("#divFriends").empty();if(0===s.nSMID||0===s.nRelationType)return $("#relationType").focus().closest(".form-group").addClass("has-error"),void alert("Не можливо визначити тип відношень для даної соціальної мережі. Оберіть, будь ласка, тип відношень");$("span","#btnFriends").text("("+s.arFriends.length+")");var i=_.template($("#tmplUserAccount").html()),r=s.nSMID;s.arFriends.forEach(function(e){var t=i({id:e.fbID,title:e.title,link:s.arSM[r].site+s.arSM[r].idPrefix+e.fbID,img:1===s.nSMID?e.face:"img/man.jpg",icon:1===s.nRelationType?"handshake-o":"rss"});$(t).appendTo(a)})},s.prototype.loadFriends=function(){if(0===s.arFriends.length)return alert("Список друзів пустий. Можливо, Ви забули натиснути на кнопку показу друзів."),!1;if(""===$.trim($("#filename").val()))return alert("Введіть, будь ласка, назву вихідного файлу"),$("#filename").focus(),!1;var e=encodeURIComponent(JSON.stringify(s.arFriends));return s.WITH_FACES_MAX_COUNT<s.arFriends.length&&$("input[name=withfaces]","#fmGetFriends").prop("checked",!1),$("input[name=data]","#fmGetFriends").val(e),setTimeout(function(){$("#ta,#filename").val(""),$("#divFriends").empty(),$("span","#btnFriends").text(""),s.setDataTypeValues(0,0),s.arFriends=[]},1e3),!0},s.prototype.onChangeRelationType=function(){2==s.nSMID?($(this).closest(".form-group").removeClass("has-error"),fbf.changeRelationType(parseInt($(this).val()))):($(this).val(s.nRelationType.toString()),alert("Не можливо змінити тип відношень для даної соціальної мережі!"))},s.WITH_FACES_MAX_COUNT=200,s.arFriends=[],s.arSM={1:{site:"https://www.facebook.com/",idPrefix:""},2:{site:"https://vk.com/",idPrefix:"id"},3:{site:"https://ok.ru/",idPrefix:"profile/"}},s.nSMID=0,s.nRelationType=0,s}(),fbf=new Fbf;$(document).ready(function(){$("#btnFriends").click(fbf.getFriends),$("#fmGetFriends").submit(fbf.loadFriends),$("#relationType").change(fbf.onChangeRelationType)});