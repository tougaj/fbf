"use strict";var fbf=new function(){var a=200,s=[],n={1:{site:"https://www.facebook.com/",idPrefix:""},2:{site:"https://vk.com/",idPrefix:"id"},3:{site:"https://ok.ru/",idPrefix:"profile/"}},c=0,f=0;function d(e,t){c=e,f=t,$("#smID,#fake_smID").val(c),$("#relationType,#fake_relationType").val(f)}this.getFriends=function(){var e,t=$("#ta").val();/\.userapi\.com/i.test(e=t)?d(2,1):/i\.mycdn\.me/i.test(e)?d(3,1):/friend_list_item/i.test(e)?d(1,1):/fbProfileBrowserListItem/i.test(e)?d(1,2):d(0,0);var r=[],i=$(t);if(1===f)switch(c){case 1:$('li>[data-testid="friend_list_item"]',i).each(function(){var e=$("a[data-hovercard]",this).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(e&&e[1]){var t=e[1],i=$('img[role="img"]',this).attr("aria-label"),a=$('img[role="img"]',this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}});break;case 2:$(".friends_user_row",i).each(function(){var e=$(this).attr("id").match(/friends_user_row(\d+)/);if(e&&e[1]){var t=e[1],i=$(".friends_field_title a",this).html().replace(/<br>/gi," "),a=$("img.friends_photo_img",this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}});break;case 3:$(".ugrid_i",i).each(function(){var e=$(".entity-item",this).data("entity-id"),t=$(".ucard-w_t a",this).html().replace(/<br>/gi," "),i="https:"+$("img.photo_img",this).attr("src");r.push({fbID:e,title:t,face:_.unescape(i)})})}else switch(c){case 1:$("li.fbProfileBrowserListItem",i).each(function(){var e=$("a[data-hovercard]",this).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(e&&e[1]){var t=e[1],i=$('img[role="img"]',this).attr("aria-label"),a=$('img[role="img"]',this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}})}s=_.map(r,function(e){return e.smID=c,e.relationType=f,e}),function(){var i=$("#divFriends").empty();$("span","#btnFriends").text("("+s.length+")");var a=_.template($("#tmplUserAccount").html());s.forEach(function(e){var t=a({id:e.fbID,title:e.title,link:n[c].site+n[c].idPrefix+e.fbID,img:1===c?e.face:"man.jpg",icon:1===f?"handshake-o":"rss"});$(t).appendTo(i)})}(),$("input[name=withfaces]","#fmGetFriends").prop("checked",s.length<=a)},this.loadFriends=function(){if(0===s.length)return alert("Список друзів пустий. Можливо, Ви забули натиснути на кнопку показу друзів."),!1;if(""===$.trim($("#filename").val()))return alert("Введіть, будь ласка, назву вихідного файлу"),$("#filename").focus(),!1;var e=encodeURIComponent(JSON.stringify(s));return a<s.length&&$("input[name=withfaces]","#fmGetFriends").prop("checked",!1),$("input[name=data]","#fmGetFriends").val(e),setTimeout(function(){$("#ta,#filename").val(""),$("#divFriends").empty(),$("span","#btnFriends").text(""),d(0,0),s=[]},1e3),!0}};$(document).ready(function(){$("#btnFriends").click(fbf.getFriends),$("#fmGetFriends").submit(fbf.loadFriends)});