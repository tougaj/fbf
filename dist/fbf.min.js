"use strict";var fbf=new function(){var a=200,n=[],c={1:{site:"https://www.facebook.com/",idPrefix:""},2:{site:"https://vk.com/",idPrefix:"id"},3:{site:"https://ok.ru/",idPrefix:"profile/"}},f=0,d=0;function s(e,t){f=e,d=t,$("#smID,#fake_smID").val(f),$("#relationType,#fake_relationType").val(d)}this.getFriends=function(){var e,t=$("#ta").val();/\.userapi\.com/i.test(e=t)?s(2,1):/i\.mycdn\.me/i.test(e)?s(3,1):/friend_list_item/i.test(e)?s(1,1):/fbProfileBrowserListItem/i.test(e)?s(1,2):s(0,0);var r=[];if(1===d)switch(f){case 1:var i=$(t);$('li>[data-testid="friend_list_item"]',i).each(function(){var e=$("a[data-hovercard]",this).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(e&&e[1]){var t=e[1],i=$('img[role="img"]',this).attr("aria-label"),a=$('img[role="img"]',this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}});break;case 2:i=$(t),$(".friends_user_row",i).each(function(){var e=$(this).attr("id").match(/friends_user_row(\d+)/);if(e&&e[1]){var t=e[1],i=$(".friends_field_title a",this).html().replace(/<br>/gi," "),a=$("img.friends_photo_img",this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}});break;case 3:i=$(t),$(".ugrid_i",i).each(function(){var e=$(".entity-item",this).data("entity-id"),t=$(".ucard-w_t a",this).html().replace(/<br>/gi," "),i="https:"+$("img.photo_img",this).attr("src");r.push({fbID:e,title:t,face:_.unescape(i)})})}else switch(f){case 1:i=$(t),$("li.fbProfileBrowserListItem",i).each(function(){var e=$("a[data-hovercard]",this).eq(0).data("hovercard").match(/hovercard\/user.php\?id=(\d+)/);if(e&&e[1]){var t=e[1],i=$('img[role="img"]',this).attr("aria-label"),a=$('img[role="img"]',this).attr("src");r.push({fbID:t,title:i,face:_.unescape(a)})}})}n=_.map(r,function(e){return e.smID=f,e.relationType=d,e}),function(){var r=$("#divFriends").empty();$("span","#btnFriends").text("("+n.length+")");var s=_.template($("#tmplUserAccount").html());n.forEach(function(e,t,i){var a=s({id:e.fbID,title:e.title,link:c[f].site+c[f].idPrefix+e.fbID,img:1===f?e.face:"man.jpg",icon:1===d?"handshake-o":"rss"});$(a).appendTo(r)})}(),$("input[name=withfaces]","#fmGetFriends").prop("checked",n.length<=a)},this.loadFriends=function(){if(0===n.length)return alert("Список друзів пустий. Можливо, Ви забули натиснути на кнопку показу друзів."),!1;if(""===$.trim($("#filename").val()))return alert("Введіть, будь ласка, назву вихідного файлу"),$("#filename").focus(),!1;var e=encodeURIComponent(JSON.stringify(n));return a<n.length&&$("input[name=withfaces]","#fmGetFriends").prop("checked",!1),$("input[name=data]","#fmGetFriends").val(e),setTimeout(function(){$("#ta,#filename").val(""),$("#divFriends").empty(),$("span","#btnFriends").text(""),s(0,0),n=[]},1e3),!0}};$(document).ready(function(){$("#btnFriends").click(fbf.getFriends),$("#fmGetFriends").submit(fbf.loadFriends)});